#!/bin/sh

# ----------------------------------------------------------
# Script to start a X3 server
#
# Created by Xu Xiao, July 14 2017
# ----------------------------------------------------------

# sub function
usage(){
    echo "usage: "
    echo "   ./x3_server start   :"
    echo "        start a x3 server with configuration defined in config.txt"
    echo "   ./x3_server stop    :" 
    echo "        stop a x3 server"
    echo "   ./x3_server restart :"
    echo "        restart a x3 server with configuration defined in config.txt"
}


# main function

# input parameter check
if [ $# != 1 ]
then
    usage
    exit 1
fi

# change to src directory
cd ../src

case "$1" in
    "start")
        sleep 1s
        erl -noshell -s x3_server start &
        ;;
    "stop")
        #erl -noshell -s x3_server stop &
        ps -efww | grep -w 'beam.smp' | grep -v grep | cut -c 9-15 | xargs kill -9
        ;;
    "restart")
        ps -efww | grep -w 'beam.smp' | grep -v grep | cut -c 9-15 | xargs kill -9
        sleep 1s
        erl -noshell -s x3_server start &
        ;;
    *)
        usage
        exit 1
        ;;
esac


